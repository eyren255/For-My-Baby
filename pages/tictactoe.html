<!DOCTYPE html>
<html lang="en" class="theme-kitty">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Cute ticâ€‘tacâ€‘toe with hearts and sparkles." />
        <meta property="og:title" content="Ticâ€‘tacâ€‘toe Hearts Â· For My Baby" />
        <meta property="og:description" content="Play a cute hearts ticâ€‘tacâ€‘toe game." />
        <meta property="og:type" content="website" />
        <title>Ticâ€‘tacâ€‘toe Hearts Â· For My Baby</title>
        <link rel="icon" type="image/svg+xml" href="../favicon.svg" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;500;700&family=Press+Start+2P&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="../styles.css" />
        <link rel="manifest" href="../site.webmanifest" />
        <script defer src="../app.js"></script>
        <style>
            .board {
                display: grid;
                grid-template-columns: repeat(3, 80px);
                gap: 8px;
                justify-content: center;
                margin: 12px 0;
            }
            .cell {
                width: 80px;
                height: 80px;
                display: grid;
                place-items: center;
                font-size: 36px;
                border: 1px solid var(--border);
                border-radius: 12px;
                background: #fff;
                cursor: pointer;
            }
            .meta {
                display: flex;
                gap: 8px;
                justify-content: center;
                margin-top: 8px;
            }
        </style>
    </head>
    <body>
        <header class="site-header">
            <div class="container wide row between center">
                <a class="brand" href="../index.html">For My Baby</a>
                <nav class="nav">
                    <a href="./quiz.html">Love Quiz</a>
                    <a href="./timeline.html">Timeline</a>
                    <a href="./polaroid.html">Polaroid Wall</a>
                    <a href="./tictactoe.html" aria-current="page">Ticâ€‘tacâ€‘toe</a>
                </nav>
            </div>
        </header>
        <main class="container wide">
            <section class="section card">
                <h1 class="section-title">ðŸŽ² Ticâ€‘tacâ€‘toe Hearts</h1>
                <div
                    class="u-flex u-gap-10 u-wrap"
                    style="justify-content: center; align-items: center"
                >
                    <div id="turn" class="muted">
                        Turn:
                        <b>ðŸ’•</b>
                    </div>
                    <label
                        class="chip"
                        for="mode"
                        style="display: inline-flex; gap: 6px; align-items: center"
                    >
                        Mode
                        <select id="mode" class="chip" style="background: #fff; border: none">
                            <option value="hh">Human vs Human</option>
                            <option value="ha" selected>Human vs AI (You first)</option>
                            <option value="ah">AI vs Human (AI first)</option>
                        </select>
                    </label>
                </div>
                <div id="board" class="board"></div>
                <div class="meta">
                    <button id="reset" class="btn pixel">Reset â†º</button>
                    <span id="status" class="muted"></span>
                </div>
            </section>
        </main>
        <footer class="site-footer">
            <div class="container center muted">
                Made with ðŸ’• Â· Â©
                <span id="year"></span>
            </div>
        </footer>
        <script>
            document.getElementById("year").textContent = new Date().getFullYear();
            const boardEl = document.getElementById("board");
            const statusEl = document.getElementById("status");
            const turnEl = document.getElementById("turn");
            const reset = document.getElementById("reset");
            const modeSel = document.getElementById("mode");
            let cells = Array(9).fill("");
            let turn = "ðŸ’•"; // other: âœ¨
            const HUMAN = "ðŸ’•";
            const AI = "âœ¨";

            function emptyIndices(b) {
                const r = [];
                for (let i = 0; i < 9; i++) if (!b[i]) r.push(i);
                return r;
            }
            function checkWinnerVal(b) {
                const w = winner(b);
                if (w === AI) return 1;
                if (w === HUMAN) return -1;
                if (emptyIndices(b).length === 0) return 0;
                return null;
            }
            function minimax(b, player) {
                const res = checkWinnerVal(b);
                if (res !== null) return { score: res };
                const moves = [];
                for (const i of emptyIndices(b)) {
                    const move = { index: i };
                    b[i] = player;
                    const next = player === AI ? minimax(b, HUMAN) : minimax(b, AI);
                    move.score = next.score;
                    b[i] = "";
                    moves.push(move);
                }
                if (player === AI) {
                    let best = -Infinity,
                        bestMove = 0;
                    for (let i = 0; i < moves.length; i++)
                        if (moves[i].score > best) {
                            best = moves[i].score;
                            bestMove = i;
                        }
                    return moves[bestMove];
                } else {
                    let best = Infinity,
                        bestMove = 0;
                    for (let i = 0; i < moves.length; i++)
                        if (moves[i].score < best) {
                            best = moves[i].score;
                            bestMove = i;
                        }
                    return moves[bestMove];
                }
            }
            function aiMove() {
                if (winner(cells) || emptyIndices(cells).length === 0) return;
                const best = minimax(cells.slice(), AI);
                const idx = best.index;
                if (idx != null && cells[idx] === "") {
                    cells[idx] = AI;
                    turn = HUMAN;
                    update();
                }
            }
            function render() {
                boardEl.innerHTML = "";
                cells.forEach((v, i) => {
                    const c = document.createElement("button");
                    c.className = "cell";
                    c.textContent = v;
                    c.disabled = !!v || winner(cells);
                    c.addEventListener("click", () => {
                        if (cells[i] || winner(cells)) return;
                        if (modeSel.value === "hh") {
                            cells[i] = turn;
                            turn = turn === HUMAN ? AI : HUMAN;
                            update();
                        } else {
                            // Human vs AI modes: human is always HUMAN symbol
                            cells[i] = HUMAN;
                            turn = AI;
                            update();
                            // Delay AI a tick for UX
                            setTimeout(() => {
                                if (modeSel.value !== "hh" && !winner(cells)) aiMove();
                            }, 60);
                        }
                    });
                    boardEl.appendChild(c);
                });
                turnEl.innerHTML = "Turn: <b>" + turn + "</b>";
            }
            function lines(b) {
                return [
                    [b[0], b[1], b[2]],
                    [b[3], b[4], b[5]],
                    [b[6], b[7], b[8]],
                    [b[0], b[3], b[6]],
                    [b[1], b[4], b[7]],
                    [b[2], b[5], b[8]],
                    [b[0], b[4], b[8]],
                    [b[2], b[4], b[6]]
                ];
            }
            function winner(b) {
                return lines(b).find((l) => l[0] && l[0] === l[1] && l[1] === l[2])?.[0] || "";
            }
            function update() {
                render();
                const w = winner(cells);
                statusEl.textContent = w ? `Winner: ${w}` : cells.every(Boolean) ? "Draw" : "";
            }
            reset.addEventListener("click", () => {
                cells = Array(9).fill("");
                turn = modeSel.value === "ah" ? AI : HUMAN;
                update();
                if (modeSel.value === "ah") setTimeout(aiMove, 80);
            });
            modeSel.addEventListener("change", () => {
                // reset on mode change
                cells = Array(9).fill("");
                turn = modeSel.value === "ah" ? AI : HUMAN;
                update();
                if (modeSel.value === "ah") setTimeout(aiMove, 80);
            });
            update();
            if (modeSel.value === "ah") setTimeout(aiMove, 80);
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker.register("../sw.js").catch(() => {});
                });
            }
        </script>
    </body>
</html>
